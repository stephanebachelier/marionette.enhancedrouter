/*! marionette.enhancedrouter - v0.2.1
 *  Release on: 2014-06-25
 *  Copyright (c) 2014 St√©phane Bachelier
 *  Licensed MIT */
!function(a,b){"function"==typeof define&&define.amd?define(["backbone","marionette"],function(c,d){return a.returnExportsGlobal=b(c,d)}):"object"==typeof exports?module.exports=b(require("backbone"),require("marionette")):a.LazyRouter=b(backbone,marionette)}(this,function(a,b){"use strict";var c=a.Router.extend({constructor:function(b){a.Router.apply(this,arguments),this.options=b||{},this.options.setup&&this.setup(),this.isStarted=!1},setup:function(){var a=this.getOption("appRoutes"),b=this._getController();this.processAppRoutes(b,a),this.on("route",this._processOnRoute,this)},appRoute:function(a,b){var c=this._getController();this._addAppRoute(c,a,b)},_processOnRoute:function(a,b){var c=_.invert(this.appRoutes)[a];_.isFunction(this.onRoute)&&this.onRoute(a,c,b)},processAppRoutes:function(a,b){if(b){var c=_.keys(b).reverse();_.each(c,function(c){this._addAppRoute(a,c,b[c])},this)}},_getController:function(){return this.getOption("controller")||this},_addAppRoute:function(a,b,c){var d=function(){this.triggerMethod("before:route",[b].concat(arguments));var a=this._getController(),d=a[c];if(!d)throw new Error('Method "'+c+'" was not found on the controller');d&&d.apply(a,arguments),this.triggerMethod("after:route",[b].concat(arguments))};this.route(b,c,_.bind(d,a))},onBeforeRoute:function(a){this.isStarted||(this.isStarted=!0,this.trigger("router:start",a))},getOption:function(a){return b.getOption(this,a)},triggerMethod:b.triggerMethod});return a.LazyRouter=c,c});